<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PSA Doubling Time Calc</title>
    <link rel="stylesheet" href="static/css/table.css" />
    <script src="static/js/script.js"></script>
    <script src="https://unpkg.com/simple-statistics@7.7.5/dist/simple-statistics.min.js"></script>
    <style>
      

      
    </style>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"/>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script> -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
      google.charts.load("current", { packages: ["corechart"] });
    </script>
    
  </head>

  <body onload="myOnload()">
  
    <!--Navbar-->
    <nav class="navbar bg-dark navbar-dark container ">
      <span class="navbar-brand mx-auto">PSA Doubling Time Calculator</span>
      <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#myModal">Help</button>
    </nav>

    <div class="container p-0 bg-light" id="container">
    
      
    <!-- The Modal WORK IN PROGRESS -->
    <div class="modal" id="myModal">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
    
          <!-- Modal Header -->
          <div class="modal-header">
            <h4 class="modal-title">PSA Doubling Time Help</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
    
          <!-- Modal body -->
          <div class="modal-body">
            <p>This is a PSA doubling time calculator desgined to work with Kaiser Nor Cal PSA data.
              <br>
              <br>
              <b>Instructions: </b>
              <ol>
                <li>Copy and paste ".lastpsa" or ".allpsa" PSA from HealthConnect into the white textarea.</li>
                <li>Hit the blue button "Parse & Calc". This will automatically sort through the data, remove unwanted text/spaces and PSA Free data. </li>
                <li>The PSA data is shown in a table along with the PSA Doubling Time in months and years. </li>
                <li>Use the copy button to copy the results to your clipboard for easy copy and paste into your note. </li>
              </ol>
              <b>Advanced Features</b><br>
              <ol>
                <li>Discarded Lines: Shows all data removed during data processing</li>
                <li>Regular Expression: This is for advanced users who would like to modify the regular expression to allow for custom PSA data inputs.</li>
              </ol>
              
            </p>
            <p>Feedback or Suggestions please email me: thakerm@gmail.com</p>
           

          </div>
    
          <!-- Modal footer -->
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
          </div>
    
        </div>
      </div>
    </div>
     
      <!--Input Template Box-->
      
       
          <div class="row pt-2">
            <label><h4>Copy and paste your PSA data into the textbox:</h4></label>
            <div class="col-auto">
            
            <textarea  id="entry" rows="10" cols="57" placeholder="Please copy and paste your PSA data here. No need to edit">
              Test Result	Value	Date/Time
•	PSA	8.1 (H)	05/25/2022
•	PSA	6.5 (H)	10/12/2021
•	PSA	7.1 (H)	05/12/2021
•	PSA	5.7 (H)	03/12/2021
•	PSA	6.1 (H)	05/29/2020
•	PSA	5.6 (H)	07/23/2019
•	PSA	   5.0	09/10/2018
•	PSA	   4.7	04/25/2018
•	PSA	   5.9	08/18/2017
•	PSA	   5.1	07/13/2016
•	PSA	   5.6	12/03/2015
•	PSA	   6.3	06/03/2015
                        
              </textarea>
                    
          </div>
        </div>
          <div class="row">
            <div class="col-auto">
              <p>
                <button type="button" class="btn btn-primary" onclick="parse()">
                  Parse & Calc
                </button>
              </p>
            </div>

            <div class="col-auto">
              <button type="button" class="btn btn-secondary" onclick="clearInput()">
                Clear
              </button>
            </div>
          </div>
          <div class="row">

            <div class="col">
            
          <input type="checkbox"  id="advanced" value="Advanced Features" onclick="advancedToggle()">
          <label for="advanced">Advanced Features</label>
          
        </div>
        </div>

        <div  id="discardTemplate" style="display: none">
          <div class="row" >
            <div class="col-auto">
              <h4 class="derived">Discarded Lines</h4>
              <textarea id="discarded" rows="4" cols="50"></textarea>
              <div id="num_discarded"></div>
            </div>
            <div class="col-auto">
              <h4 class="derived">Input Template to RegExp</h4>
              <textarea
                id="regex"
                oninput="validate_regex_box()"
                rows="4"
                cols="50"
              ></textarea>
            </div>
          </div>
          <hr>
        </div>
        
      
   
    <div id="PSA_calc" style="display: none" class="pt-3">
     
      <div class="row">
        <div class="col-6">
        <h4 class="derived">Derived PSA Data Table</h4></div>
        <div class="col-6" ><h4 class="derived">PSA Doubling Time</h4></div>
        
      </div>
      <div class="row">
        <div class="col-auto">
          <div id="PSA_data"></div>
        </div>
        <div class="col-auto">
          
          <div class="input-group col-auto">
            <input readonly class = "form-control" id="psadt_months"> 
            <div class="input-group-append">
              <button id = "psadt_months_button" class="btn btn-outline-success" type="button" onclick="copyPaste('#psadt_months','#psadt_months_button')">Copy</button>
        
            </div>
          </div>
          <p></p>
          <div class="input-group col-auto">
            <input readonly class = "form-control" id="psadt_years" aria-describedby="basic-addon2" placeholder="PSA doubling time" aria-label="PSA doubling time in years"> 
            <div class="input-group-append">
              <button class="btn btn-outline-success" id="psadt_years_button" type="button" onclick="copyPaste('#psadt_years','#psadt_years_button')">Copy</button>
            </div>
          </div>
        
          
        
        </div>
        
        <div class="row">
          <div class="col">
           <p></p> <input type="checkbox"  id="scatter" value="Scatter_Plot" onclick="scatterPlot()">
            <label for="scatter">Show Scatter Plot</label>
          </div>
        </div>
      
      </div>

    </div>
    <p></p>
    <div  class = "row" id="scatterplotdiv" style="display: none">
      <div class="col">
        <h4 class="derived">Scatter Plot & TrendLine</h4>
        <div class="col" id="myChart"></div>
      </div>
    </div>
  
   
    <div> 
      <h3>References</h3>
      <ul>
        <li>
          <a href="https://www.mskcc.org/nomograms/prostate/psa_doubling_time">MSK PSA Doubling Time Calculator</a>

        </li>
        <li>
          <a href="https://www.mdcalc.com/psa-doubling-time-psadt-calculator"
            >mdcalc.com</a
          >
        </li>
        <li>
          <a
            href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Cheatsheet"
            target="_blank"
            >Javascript RegEx Cheatsheet</a
          >
        </li>
      </ul>
    </div>
    
  </body>
</html>
